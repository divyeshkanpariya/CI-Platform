@{
    Layout = null;
}
@model IEnumerable<CI_Platform.Models.ViewModels.StoryCardViewModel>

@using Microsoft.AspNetCore.Http;
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>@ViewData["Title"] - CI_Platform</title>
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
        <link rel="stylesheet" href="~/CI_Platform.styles.css" asp-append-version="true" />
   

        <!-- Font Awesome CSS -->
        <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css'>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    </head>
    <body>
@{
    var currCard = @Model.FirstOrDefault();
    var totalMediaCount = currCard.StoryMediaList.Count + currCard.StoryVideoPaths.Count;
    var totalScreens = (totalMediaCount/4) + 1;
    if(totalMediaCount % 4 == 0)
    {
        totalScreens -= 1;
    }
    string GetVideoUrl(string path)
    {
        string src = "";
        src += "https://www.youtube.com/embed/";
        src += path.Substring(path.IndexOf("=") + 1);
        src += "?autoplay=1&mute=1";
        return src;
    }
    string GetThumbnail(string path)
    {
        string src = "";
        src += "https://img.youtube.com/vi/";
        src += path.Substring(path.IndexOf("=") + 1);
        src += "/0.jpg";
        return src;

    }
}

<p class="d-none" id="getStoryId">@currCard.StoryId</p>
<div class="container-fluid px-5 pt-5">
    <div class="row">
        @* -------- Image Slider -------- *@
        <div class="col-lg-6 ">
            <div class="container mt-4 h-100">
                <div class="carousel-container position-relative row ">

                    <!-- Sorry! Lightbox doesn't work - yet. -->

                    <div id="myCarousel" class="carousel px-0 slide" data-ride="carousel">
                        <div class="carousel-inner" id= "carouselInnerDiv">
                                @if (@totalMediaCount != 0)
                                {
                                    var x = 0;
                                    @for (x=0;x<@currCard.StoryMediaList.Count;x++)
                                    {
                                        @if (x == 0)
                                        {
                                            <div class="carousel-item carousel-img-div active" data-slide-number="@x" style="max-height:625px ;">
                                                <img src="@currCard.StoryMediaList[x]" class="d-block scroll-img w-100" alt="..." data-remote="https://source.unsplash.com/Pn6iimgM-wo/" data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                                            </div>
                                        }else{
                                            <div class="carousel-item carousel-img-div" data-slide-number="@x" style="max-height:625px ;">
                                                <img src="@currCard.StoryMediaList[x]" class="d-block scroll-img w-100" alt="..." data-remote="https://source.unsplash.com/Pn6iimgM-wo/" data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
                                            </div>
                                        }

                                    }
                                    @for (x = @currCard.StoryMediaList.Count; x < totalMediaCount; x++)
                                    {
                                        
                                        @if (x == 0)
                                        {
                                            <div class="carousel-item carousel-img-div active" data-slide-number="@x" style="max-height:625px ">

                                                <img src="@GetVideoUrl(@currCard.StoryVideoPaths[0])" class="d-block scroll-img w-100" alt="..." data-remote="https://source.unsplash.com/Pn6iimgM-wo/" data-type="video" data-toggle="lightbox" data-gallery="example-gallery">
                                            </div>
                                        }
                                        else{
                                            <div class="carousel-item carousel-img-div" data-slide-number="@x" style="max-height:625px ;">
                                                <iframe class="d-block scroll-img w-100" src="@GetVideoUrl(@currCard.StoryVideoPaths[0])" allowfullscreen></iframe>
                                            </div>
                                        }
                                    }
                                }


                            </div>

                        </div>
                        
                        <!-- Carousel Navigation -->
                    <div id="carousel-thumbs" class="carousel slide">
                            <div class="carousel-inner h-100 w-100" id="carouselInnerDiv">
                                @if (@totalMediaCount != 0)
                                {
                                    var x = 0;
                                    @for (var j = 0; j < (totalScreens); j++)
                                    {
                                        var count = @totalMediaCount;
                                        x = j * 4;
                                        if (x == 0)
                                        {
                                            <div class="carousel-item h-100 active">
                                                <div class="row mx-0 h-100">
                                                    @for (var i = 0; i < 4; i++)
                                                    {
                                                        @if (count <= x)
                                                        {
                                                            break;
                                                        }
                                                        @if (x == 0)
                                                        {
                                                            <div id="carousel-selector-@x" class="thumb col-3 h-100 px-1 pt-1 selected" data-target="#myCarousel" data-slide-to="@x">
                                                                <img  src="@currCard.StoryMediaList[x]" class="img-fluid w-100" alt="...">
                                                            </div>

                                                        }
                                                        else if(x<@currCard.StoryMediaList.Count)
                                                        {
                                                            <div id="carousel-selector-@x" class="thumb col-3 h-100 px-1 pt-1" data-target="#myCarousel" data-slide-to="@x">
                                                                <img src="@currCard.StoryMediaList[x]" class="img-fluid w-100" alt="...">
                                                            </div>
                                                        }
                                                        else{
                                                            <div id="carousel-selector-@x" class="thumb col-3 h-100 px-1 pt-1" data-target="#myCarousel" data-slide-to="@x">
                                                                <img class="img-fluid w-100 h-100" src="@GetThumbnail(@currCard.StoryVideoPaths[@x - @currCard.StoryMediaList.Count])"></img>
                                                            </div>
                                                        }
                                                        x++;
                                                    }
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="carousel-item h-100">
                                                <div class="row mx-0 h-100">
                                                    @for (var i = 0; i < 4; i++)
                                                    {
                                                        @if (count <= x)
                                                        {
                                                            break;
                                                        }
                                                        if(x<@currCard.StoryMediaList.Count)
                                                        {
                                                            <div id="carousel-selector-@x" class="thumb col-3 h-100 px-1 pt-1" data-target="#myCarousel" data-slide-to="@x">
                                                                <img src="@currCard.StoryMediaList[x]" class="img-fluid w-100" alt="...">
                                                            </div>
                                                        }
                                                        else{
                                                            <div id="carousel-selector-@x" class="thumb col-3 h-100 px-1 pt-1" data-target="#myCarousel" data-slide-to="@x">
                                                                <img class="img-fluid w-100 h-100" src="@GetThumbnail(@currCard.StoryVideoPaths[@x - @currCard.StoryMediaList.Count])"></img>
                                                            </div>
                                                        }
                                                        
                                                        x++;

                                                    }
                                                </div>
                                            </div>
                                        } 
                                    }
                                }

                        </div>
                        <a class="carousel-control-prev bg-black" href="#carousel-thumbs" role="button" data-slide="prev" style="width:25px;">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only"></span>
                        </a>
                        <a class="carousel-control-next bg-black" href="#carousel-thumbs" role="button" data-slide="next" style="width:25px;">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only"></span>
                        </a>
                    </div>

                </div> <!-- /row -->
            </div> <!-- /container -->
        </div>
        @* --------- Profile Details --------- *@
        <div class="col-lg-6 mt-4">
            <div class="d-flex justify-content-around align-items-end">
               
                <div class=" text-center">
                    <img class="volunteer-profile-img" src="@currCard.UserProfile" alt="volunteer1" style="width:100px;"/>
                    <p>@currCard.FirstName @currCard.LastName</p>
                </div>   
                 
                <div class="border text-muted storyViews justify-content-center align-items-center mb-3">
                    <img src="~/images/eye.png" alt="eye" /><span class="ps-2 pb-1">@currCard.Views Views</span>
                </div>
            </div>
            <div>
                @Html.Raw(@currCard.WhyIVol)
            </div>
            
            
           
            
            </div>
        </div>
    </div>
    <div class="px-5 mb-5">
        <ul class="nav nav-tabs pt-3" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-1" type="button" role="tab" aria-controls="home" aria-selected="true">
                    @currCard.Title
                </button>
            </li>
            
        </ul>
        <div class="mt-3 ">
            @Html.Raw(@currCard.Description)
        </div>
    </div>
</div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    
</body>
</html>