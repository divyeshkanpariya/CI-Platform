@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@{
    Layout = "Home_Layout";
}
@model CI_Platform.Models.ViewModels.ShareYourStoryViewModel

<div class="container mt-4 mb-4">
    <form>
    <div>
            
        <h1 class="h2 mb-4">Share Your Story</h1>
        <div class="row">
            <div class="col">
                <label asp-for="Mission" class="form-label" id="mission">Select Mission</label>
                <select asp-for="Mission" name="Mission"class="form-select mb-3" aria-label=".form-select-lg example">
                    <option selected>Select Your Mission</option>
                    @foreach(var mission in @Model.MissionList){
                        <option value="@mission.MissionId">@mission.Title</option>
                    }
                    
                </select>
                
            </div>
            
            <div class="col">
                <label asp-for="StoryTitle" class="form-label" for="storyTitle">My Story Title</label>
                <input  asp-for="StoryTitle" name="StoryTitle" class="form-control" id="storyTitle" placeholder="Enter Story Title" autofocus required>
            </div>
            <div class="col">
                <label asp-for="Date" class="form-label" for="date">Date</label>
                <input asp-for="Date" name="Date" class="form-control" type="date" placeholder="Select Date">
            </div>
                
        </div>
        <label asp-for="StoryDescription">My Story</label>
        <div class="form-group">
            <textarea asp-for="StoryDescription" id="editor"></textarea>
        </div>
        <div >
            <label asp-for="StoryVideoUrl" class="form-label" for="videoURL">Enter Video URL</label>
            <input asp-for="StoryVideoUrl" class="form-control" id="videoURL" placeholder="Enter your URL" autofocus required>
        </div>
        <div class="row mt-2">
            <div class="col-12">
                <div class="form-group">
                    <label asp-for="Photos" class="form-label">Upload Your Photos</label>
                        <div class="d-flex justify-content-center align-items-center border input-div position-relative" style="height:150px">


                            <input asp-for="Photos" id="imageupload" type="file" class="file" multiple="multiple" accept="image/jpeg, image/png, image/jpg"><img src="~/images/drag-and-drop.png">

                        </div>
                </div>

            </div>
            <output class="mt-3" id="preview"></output>
        </div>
        <div class="row">
            <div class="py-3 col-6">              
                <button type="button" class="Apply-mission-btn py-2 text-decoration-none border border-2 text-muted">Cancel</button>
            </div>
            <div class="col-6 justify-content-end">
                <div class="d-flex justify-content-end">
                    <div class="py-3 mx-3">              
                        <button type="button" class="Apply-mission-btn px-3 py-2 text-decoration-none">Save</button>
                    </div>
                    <div class="py-3 mx-3">           
                        <button type="submit" class="Apply-mission-btn px-3 py-2 text-decoration-none">Submit</button>
                    </div>
                </div>  
            </div>
        </div>
    </div>
    </form>
        
</div>
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>

<script>
  tinymce.init({
    selector: 'textarea#editor',
    //statusbar: false,
    skin: 'bootstrap',
    plugins: 'lists, link, image, media',
    toolbar: ' bold italic strikethrough | superscript subscript removeformat ',
    menubar: false,
  });


    const inputDiv = document.querySelector(".input-div");
    const input = document.querySelector("#imageupload");
    const output = document.querySelector("#preview");
    let imagesArray = [];

    input.addEventListener("change", () => {

        const files = input.files;
        for (let i = 0; i < files.length; i++) {
            imagesArray.push(files[i])
        }
        displayImages();
    });

    inputDiv.addEventListener("drop", () => {
    e.preventDefault();
    const files = e.dataTransfer.files;
    for (let i = 0; i < files.length; i++) {
        if (!files[i].type.match("image")) continue;

        if (imagesArray.every(image => image.name !== files[i].name))
        imagesArray.push(files[i]);
    }
    displayImages();
    });
    function displayImages() {

        let images = "";
        imagesArray.forEach((image, index) => {
            images += `<div class="image">
            <img src="${URL.createObjectURL(image)}" alt="image">
            <span onclick="deleteImage(${index})">&times;</span>
            </div>`
        });
        output.innerHTML = images;
    }

    function deleteImage(index) {
        imagesArray.splice(index, 1);
        displayImages();
    }

</script>